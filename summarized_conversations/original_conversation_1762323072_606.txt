{'role': 'assistant', 'content': '<function_calls>\n<create-file file_path="HEX-Control-Nexus/web_dashboard/dashboard_api.js">\n// HEX Control Nexus Dashboard API Integration\n\nclass DashboardAPI {\n    constructor() {\n        this.baseURL = \'http://localhost:3000\'; // Node.js webhook service\n        this.ws = null;\n        this.reconnectInterval = 5000; // 5 seconds\n    }\n    \n    // Initialize WebSocket connection\n    initWebSocket() {\n        try {\n            this.ws = new WebSocket(`ws://localhost:3000`);\n            \n            this.ws.onopen = () => {\n                console.log(\'WebSocket connected to HEX Control Nexus\');\n                this.addLog(\'WebSocket connected to backend service\', \'info\');\n            };\n            \n            this.ws.onmessage = (event) => {\n                try {\n                    const data = JSON.parse(event.data);\n                    this.handleWebSocketMessage(data);\n                } catch (error) {\n                    console.error(\'Error parsing WebSocket message:\', error);\n                }\n            };\n            \n            this.ws.onclose = () => {\n                console.log(\'WebSocket disconnected\');\n                this.addLog(\'WebSocket disconnected from backend service\', \'warn\');\n                // Attempt to reconnect\n                setTimeout(() => this.initWebSocket(), this.reconnectInterval);\n            };\n            \n            this.ws.onerror = (error) => {\n                console.error(\'WebSocket error:\', error);\n                this.addLog(\'WebSocket connection error\', \'error\');\n            };\n            \n        } catch (error) {\n            console.error(\'Failed to initialize WebSocket:\', error);\n            this.addLog(\'Failed to connect to backend service\', \'error\');\n        }\n    }\n    \n    // Handle WebSocket messages\n    handleWebSocketMessage(data) {\n        switch (data.type) {\n            case \'job_created\':\n                this.addLog(`Job created: ${data.job.id}`, \'info\');\n                this.updateJobInTable(data.job);\n                break;\n            case \'job_status\':\n                this.addLog(`Job status updated: ${data.job.id} - ${data.job.status}`, \'info\');\n                this.updateJobInTable(data.job);\n                break;\n            case \'job_completed\':\n                this.addLog(`Job completed: ${data.job.id}`, \'info\');\n                this.updateJobInTable(data.job);\n                break;\n            case \'job_failed\':\n                this.addLog(`Job failed: ${data.job.id} - ${data.error}`, \'error\');\n                this.updateJobInTable(data.job);\n                break;\n            case \'connection\':\n                this.addLog(data.message, \'info\');\n                break;\n            default:\n                console.log(\'Unknown WebSocket message type:\', data.type);\n        }\n    }\n    \n    // Add log entry to the dashboard\n    addLog(message, level = \'info\') {\n        const logsContainer = document.getElementById(\'logsContainer\');\n        if (!logsContainer) return;\n        \n        const timestamp = new Date().toISOString().substr(11, 8);\n        const logEntry = document.createElement(\'div\');\n        logEntry.className = \'log-entry\';\n        logEntry.innerHTML = `\n            <span class="timestamp">[${timestamp}]</span>\n            <span class="level ${level}">${level.toUpperCase()}</span>\n            <span class="message">${message}</span>\n        `;\n        \n        logsContainer.appendChild(logEntry);\n        \n        // Auto-scroll to bottom if enabled\n        const autoScroll = document.getElementById(\'autoScroll\');\n        if (autoScroll && autoScroll.checked) {\n            logsContainer.scrollTop = logsContainer.scrollHeight;\n        }\n    }\n    \n    // Update job in the jobs table\n    updateJobInTable(job) {\n        const jobsTableBody = document.getElementById(\'jobsTableBody\');\n        if (!jobsTableBody) return;\n        \n        // Check if job row already exists\n        let jobRow = document.getElementById(`job-${job.id}`);\n        \n        if (!jobRow) {\n            // Create new row\n            jobRow = document.createElement(\'tr\');\n            jobRow.id = `job-${job.id}`;\n            jobsTableBody.appendChild(jobRow);\n        }\n        \n        // Update row content\n        jobRow.innerHTML = `\n            <td>${job.id}</td>\n            <td>${job.task || \'N/A\'}</td>\n            <td>${job.target || \'N/A\'}</td>\n            <td><span class="status-badge ${job.status}">${job.status}</span></td>\n            <td>${job.createdAt ? new Date(job.createdAt).toLocaleString() : \'N/A\'}</td>\n        `;\n        \n        // Update metrics\n        this.updateMetrics();\n    }\n    \n    // Update dashboard metrics\n    updateMetrics() {\n        // In a real implementation, this would fetch actual metrics from the backend\n        // For demo, we\'ll simulate updates\n        \n        const totalJobsElement = document.getElementById(\'totalJobs\');\n        const completedJobsElement = document.getElementById(\'completedJobs\');\n        const failedJobsElement = document.getElementById(\'failedJobs\');\n        const pendingJobsElement = document.getElementById(\'pendingJobs\');\n        \n        if (totalJobsElement) {\n            // Simulate updating metrics\n            const randomTotal = Math.floor(Math.random() * 50) + 10;\n            totalJobsElement.textContent = randomTotal;\n            \n            if (completedJobsElement) {\n                const completed = Math.floor(randomTotal * 0.7);\n                completedJobsElement.textContent = completed;\n            }\n            \n            if (failedJobsElement) {\n                const failed = Math.floor(randomTotal * 0.1);\n                failedJobsElement.textContent = failed;\n            }\n            \n            if (pendingJobsElement) {\n                const pending = Math.floor(randomTotal * 0.2);\n                pendingJobsElement.textContent = pending;\n            }\n        }\n    }\n    \n    // Trigger a demo scraping job\n    async triggerScrapingJob() {\n        try {\n            this.addLog(\'Triggering demo scraping job...\', \'info\');\n            \n            const response = await fetch(`${this.baseURL}/webhook`, {\n                method: \'POST\',\n                headers: {\n                    \'Content-Type\': \'application/json\'\n                },\n                body: JSON.stringify({\n                    task: \'scrape\',\n                    target: \'http://quotes.toscrape.com\',\n                    options: {\n                        selectors: {\n                            title: \'title\',\n                            heading: \'h1\'\n                        }\n                    }\n                })\n            });\n            \n            const data = await response.json();\n            \n            if (response.ok) {\n                this.addLog(`Scraping job triggered successfully: ${data.jobId}`, \'info\');\n            } else {\n                this.addLog(`Failed to trigger scraping job: ${data.error}`, \'error\');\n            }\n        } catch (error) {\n            console.error(\'Error triggering scraping job:\', error);\n            this.addLog(`Error triggering scraping job: ${error.message}`, \'error\');\n        }\n    }\n    \n    // Trigger a demo webhook\n    async triggerWebhook() {\n        try {\n            this.addLog(\'Triggering demo webhook...\', \'info\');\n            \n            const response = await fetch(`${this.baseURL}/webhook`, {\n                method: \'POST\',\n                headers: {\n                    \'Content-Type\': \'application/json\'\n                },\n                body: JSON.stringify({\n                    task: \'demo\',\n                    target: \'Test Webhook\',\n                    options: {\n                        message: \'This is a test webhook from HEX Control Nexus\'\n                    }\n                })\n            });\n            \n            const data = await response.json();\n            \n            if (response.ok) {\n                this.addLog(`Webhook triggered successfully: ${data.jobId}`, \'info\');\n            } else {\n                this.addLog(`Failed to trigger webhook: ${data.error}`, \'error\');\n            }\n        } catch (error) {\n            console.error(\'Error triggering webhook:\', error);\n            this.addLog(`Error triggering webhook: ${error.message}`, \'error\');\n        }\n    }\n    \n    // Fetch jobs from backend\n    async fetchJobs() {\n        try {\n            const response = await fetch(`${this.baseURL}/jobs`);\n            const jobs = await response.json();\n            \n            if (response.ok) {\n                // Update jobs table with fetched data\n                const jobsTableBody = document.getElementById(\'jobsTableBody\');\n                if (jobsTableBody) {\n                    jobsTableBody.innerHTML = \'\';\n                    \n                    if (jobs.length === 0) {\n                        jobsTableBody.innerHTML = \'<tr><td colspan="5" class="no-data">No jobs in queue</td></tr>\';\n                        return;\n                    }\n                    \n                    jobs.forEach(job => {\n                        const row = document.createElement(\'tr\');\n                        row.id = `job-${job.id}`;\n                        row.innerHTML = `\n                            <td>${job.id}</td>\n                            <td>${job.task || \'N/A\'}</td>\n                            <td>${job.target || \'N/A\'}</td>\n                            <td><span class="status-badge ${job.status}">${job.status}</span></td>\n                            <td>${job.createdAt ? new Date(job.createdAt).toLocaleString() : \'N/A\'}</td>\n                        `;\n                        jobsTableBody.appendChild(row);\n                    });\n                }\n                \n                this.updateMetrics();\n            } else {\n                this.addLog(\'Failed to fetch jobs\', \'error\');\n            }\n        } catch (error) {\n            console.error(\'Error fetching jobs:\', error);\n            this.addLog(`Error fetching jobs: ${error.message}`, \'error\');\n        }\n    }\n}\n\n// Initialize dashboard API when DOM is loaded\ndocument.addEventListener(\'DOMContentLoaded\', () => {\n    const api = new DashboardAPI();\n    \n    // Initialize WebSocket connection\n    api.initWebSocket();\n    \n    // Set up event listeners\n    const startScrapingBtn = document.getElementById(\'startScraping\');\n    const stopScrapingBtn = document.getElementById(\'stopScraping\');\n    const triggerWebhookBtn = document.getElementById(\'triggerWebhook\');\n    const clearLogsBtn = document.getElementById(\'clearLogs\');\n    \n    if (startScrapingBtn) {\n        startScrapingBtn.addEventListener(\'click\', () => {\n            api.triggerScrapingJob();\n        });\n    }\n    \n    if (triggerWebhookBtn) {\n        triggerWebhookBtn.addEventListener(\'click\', () => {\n            api.triggerWebhook();\n        });\n    }\n    \n    if (clearLogsBtn) {\n        clearLogsBtn.addEventListener(\'click\', () => {\n            const logsContainer = document.getElementById(\'logsContainer\');\n            if (logsContainer) {\n                logsContainer.innerHTML = \'\';\n            }\n        });\n    }\n    \n    // Periodically fetch jobs\n    setInterval(() => {\n        api.fetchJobs();\n    }, 10000); // Every 10 seconds\n    \n    // Initial fetch\n    setTimeout(() => {\n        api.fetchJobs();\n    }, 1000);\n});\n</create-file>\n</function_calls>'}